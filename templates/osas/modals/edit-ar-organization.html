{% block accomplishment-edit-modal %}
<div id="accomplishmentEditModal" class="modal">
    <div class="modal-overlay" onclick="closeAccomplishmentEditModal()"></div>
    <div class="modal-container">
        <div class="modal-header">
            <div class="header-content">
                <h2>Edit Accomplishment Report</h2>
                <p class="header-description">Update accomplishment report information and content</p>
            </div>
            <button class="modal-close" onclick="closeAccomplishmentEditModal()">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>

        <form id="accomplishmentEditForm" method="post" action="" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="form-body">
                <div class="form-intro">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="var(--primary)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14 2 14 8 20 8"></polyline>
                        <line x1="16" y1="13" x2="8" y2="13"></line>
                        <line x1="16" y1="17" x2="8" y2="17"></line>
                        <polyline points="10 9 9 9 8 9"></polyline>
                    </svg>
                    <p>Update the accomplishment report information below. Fields marked with <span class="required-asterisk">*</span> are required.</p>
                </div>

                <div id="accomplishmentEditFormResponse" class="form-response"></div>
                <input type="hidden" name="report_id" id="editAccomplishmentId">

                <!-- Basic Information Section -->
                <div class="form-section">
                    <h3 class="section-title">
                        <i class='bx bx-info-circle'></i>
                        Basic Information
                    </h3>
                    <div class="form-columns">
                        <!-- Left Column -->
                        <div class="form-column">
                            <div class="form-group">
                                <label for="editAccomplishmentTitle">Report Title <span class="required-asterisk">*</span></label>
                                <input type="text" name="title" id="editAccomplishmentTitle" class="form-input" required placeholder="Enter activity title">
                            </div>

                            <div class="form-group">
                                <label for="editAccomplishmentType">Record Type <span class="required-asterisk">*</span></label>
                                <select name="record_type" id="editAccomplishmentType" class="form-input" required>
                                    <option value="">Select Record Type</option>
                                    <option value="event">Event/Activity</option>
                                    <option value="meeting">Meeting</option>
                                    <option value="training">Training/Workshop</option>
                                    <option value="community">Community Service</option>
                                    <option value="achievement">Achievement/Award</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="editDateConducted">Date Conducted <span class="required-asterisk">*</span></label>
                                <input type="date" name="date_conducted" id="editDateConducted" class="form-input" required>
                            </div>
                        </div>

                        <!-- Right Column -->
                        <div class="form-column">
                            <div class="form-group">
                                <label for="editSemester">Semester <span class="required-asterisk">*</span></label>
                                <select name="semester" id="editSemester" class="form-input" required>
                                    <option value="">Select Semester</option>
                                    <option value="1st">1st Semester</option>
                                    <option value="2nd">2nd Semester</option>
                                    <option value="summer">Summer</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="editSchoolYear">School Year <span class="required-asterisk">*</span></label>
                                <input type="text" name="school_year" id="editSchoolYear" class="form-input" required placeholder="2024-2025" pattern="\d{4}-\d{4}">
                                <small class="help-text">Format: YYYY-YYYY (e.g., 2024-2025)</small>
                            </div>

                            <div class="form-group">
                                <label for="editVenue">Venue/Location</label>
                                <input type="text" name="venue" id="editVenue" class="form-input" placeholder="Enter venue or location">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Organization Information (for OSAS staff) -->
                <div class="form-section" id="editOrganizationSection">
                    <h3 class="section-title">
                        <i class='bx bx-buildings'></i>
                        Organization Information
                    </h3>
                    <div class="form-group">
                        <label for="editOrganization">Organization</label>
                        <select name="organization" id="editOrganization" class="form-input">
                            <option value="">Select Organization (Optional)</option>
                            <!-- Organizations will be populated dynamically -->
                        </select>
                        <small class="help-text">Optional for OSAS staff. Automatically set for organization users.</small>
                    </div>
                </div>

                <!-- Quantitative Data Section -->
                <div class="form-section">
                    <h3 class="section-title">
                        <i class='bx bx-stats'></i>
                        Quantitative Data
                    </h3>
                    <div class="form-columns">
                        <div class="form-column">
                            <div class="form-group">
                                <label for="editParticipants">Number of Participants</label>
                                <input type="number" name="number_of_participants" id="editParticipants" class="form-input" min="0" value="0">
                            </div>
                        </div>
                        <div class="form-column">
                            <div class="form-group">
                                <label for="editDuration">Duration (Hours)</label>
                                <input type="number" name="duration_hours" id="editDuration" class="form-input" min="0" step="0.5" value="0.00">
                            </div>
                        </div>
                        <div class="form-column">
                            <div class="form-group">
                                <label for="editBudget">Budget Utilized (â‚±)</label>
                                <input type="number" name="budget_utilized" id="editBudget" class="form-input" min="0" step="0.01" value="0.00">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Content Section - Removed Description Field -->
                <div class="form-section">
                    <h3 class="section-title">
                        <i class='bx bx-notepad'></i>
                        Activity Content
                    </h3>
                    <!-- Removed Description Textarea -->
                    <div class="form-group">
                        <label for="editObjectives">Objectives</label>
                        <textarea name="objectives" id="editObjectives" class="form-input" rows="3" placeholder="List the specific objectives and goals of this activity..."></textarea>
                        <small class="help-text">What were you trying to achieve with this activity?</small>
                    </div>

                    <div class="form-group">
                        <label for="editOutcomes">Outcomes & Results</label>
                        <textarea name="outcomes" id="editOutcomes" class="form-input" rows="3" placeholder="Describe the outcomes, results achieved, and impact of this activity..."></textarea>
                        <small class="help-text">What were the actual results and impact of this activity?</small>
                    </div>
                </div>

                <!-- Files Section -->
                <div class="form-section">
                    <h3 class="section-title">
                        <i class='bx bx-file'></i>
                        Files & Attachments
                    </h3>

                    <!-- Current Main Report -->
                    <div class="form-group">
                        <label>Current Main Report</label>
                        <div class="current-file-display" id="editCurrentMainReport">
                            <!-- Current main report will be displayed here -->
                        </div>
                    </div>

                    <!-- Update Main Report -->
                    <div class="form-group">
                        <label for="editMainReport">Update Main Report Document</label>
                        <div class="file-upload-container">
                            <div class="file-upload-box small" id="editMainReportUploadBox">
                                <input type="file" name="main_report" id="editMainReport" class="file-input" accept=".pdf,.doc,.docx">
                                <div class="file-upload-content">
                                    <i class='bx bx-cloud-upload'></i>
                                    <div class="upload-text">
                                        <p>Drop new main report here or click to upload</p>
                                        <small>Supports PDF, DOC, DOCX (Max 10MB)</small>
                                    </div>
                                </div>
                            </div>
                            <div class="file-info small" id="editMainReportFileInfo" style="display: none;">
                                <span class="file-name" id="editMainReportFileName">No file selected</span>
                                <span class="file-size" id="editMainReportFileSize"></span>
                                <button type="button" class="file-remove" id="editRemoveMainReportFile" onclick="removeEditMainReportFile()">
                                    <i class='bx bx-x'></i>
                                </button>
                            </div>
                        </div>
                        <small class="help-text">Leave empty to keep the current main report file.</small>
                    </div>

                    <!-- Current Supporting Files -->
                    <div class="form-group">
                        <label>Current Supporting Files</label>
                        <div class="current-attachments" id="editCurrentSupportingFiles">
                            <!-- Current supporting files will be displayed here -->
                        </div>
                    </div>

                    <!-- Add New Supporting Files -->
                    <div class="form-group">
                        <label for="editSupportingFiles">Add New Supporting Files</label>
                        <div class="file-upload-container">
                            <div class="file-upload-box" id="editSupportingFilesUploadBox">
                                <input type="file" name="supporting_files" id="editSupportingFiles" class="file-input" multiple accept=".pdf,.doc,.docx,.jpg,.jpeg,.png,.xls,.xlsx,.mp4,.avi,.mov,.zip">
                                <div class="file-upload-content">
                                    <i class='bx bx-cloud-upload'></i>
                                    <div class="upload-text">
                                        <p>Drop supporting files here or click to upload</p>
                                        <small>Supports documents, images, spreadsheets, videos, archives (Max 10MB each)</small>
                                    </div>
                                </div>
                            </div>
                            <div class="file-info" id="editSupportingFilesInfo" style="display: none;">
                                <span class="file-name" id="editSupportingFilesName">No files selected</span>
                                <span class="file-count" id="editSupportingFilesCount" style="display: none;"></span>
                                <span class="file-size" id="editSupportingFilesSize"></span>
                                <button type="button" class="file-remove" id="editRemoveSupportingFiles" onclick="removeEditSupportingFiles()">
                                    <i class='bx bx-x'></i>
                                </button>
                            </div>
                        </div>
                        <small class="help-text">Add additional supporting documents, photos, certificates, etc. Existing files will be preserved.</small>
                    </div>
                </div>

                <!-- Submission Info -->
                <div class="submission-info-section">
                    <h4 class="info-title">
                        <i class='bx bx-history'></i>
                        Submission Information
                    </h4>
                    <div class="info-grid">
                        <div class="info-item">
                            <span class="info-label">Submitted by:</span>
                            <span id="editSubmittedByName" class="info-value">-</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Organization:</span>
                            <span id="editOrganizationName" class="info-value">-</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Submitted on:</span>
                            <span id="editSubmittedAt" class="info-value">-</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Last updated:</span>
                            <span id="editUpdatedAt" class="info-value">-</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-cancel" onclick="closeAccomplishmentEditModal()">Cancel</button>
                <button type="submit" class="btn btn-primary">
                    <span class="btn-text">Update Report</span>
                    <span class="btn-loader">
                        <svg viewBox="0 0 50 50">
                            <circle cx="25" cy="25" r="20" fill="none" stroke-width="5"></circle>
                        </svg>
                    </span>
                </button>
            </div>
        </form>
    </div>
</div>

<script>
// Pass organizations data from Django context to JavaScript
window.availableOrganizations = [
    {% for org in active_organizations %}
    {
        id: {{ org.id }},
        name: "{{ org.organization_name|escapejs }}",
        acronym: "{{ org.organization_acronym|escapejs }}"
    }{% if not forloop.last %},{% endif %}
    {% empty %}
    // No organizations available
    {% endfor %}
];
</script>
{% endblock accomplishment-edit-modal %}