<!DOCTYPE html>
{% load static %}
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Complaint Form</title>
  <link rel="stylesheet" href="{% static 'css/core/complaint.css' %}">
  <link rel="icon" type="image/png" href="{% static 'images/cvsu-logo.png' %}">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
  <script>
    window.jsPDF = window.jspdf.jsPDF;
  </script>
</head>
<body>
{% include 'core/navbar.html' %}

<div class="form-container">
  <div class="glass-card">
    <div class="form-header">
      <div class="header-glow"></div>
      <h2 class="form-title">
        {% if object %}Edit Complaint #{{ object.id }}{% else %}New Complaint{% endif %}
      </h2>
      <p class="form-subtitle">Please fill out all required fields to submit your complaint</p>
      <a href="{% url 'home' %}" id="top-home-btn" class="btn btn-outline-primary">
        <i class="fas fa-home"></i> Back to Home
      </a>
    </div>

    <!-- Step Progress Bar -->
    <div class="step-progress">
      <div class="progress-bar" style="width: 0%;"></div>
      <div class="step active" id="step1">
        <div class="step-number">1</div>
        <div class="step-label">Complainant</div>
      </div>
      <div class="step" id="step2">
        <div class="step-number">2</div>
        <div class="step-label">Respondent</div>
      </div>
      <div class="step" id="step3">
        <div class="step-number">3</div>
        <div class="step-label">Details</div>
      </div>
      <div class="step" id="step4">
        <div class="step-number">4</div>
        <div class="step-label">Documents</div>
      </div>
    </div>

    <!-- Error Summary -->
    <div class="error-summary" id="errorSummary" style="display: none;">
      <div class="alert alert-danger">
        <i class="fas fa-exclamation-triangle me-2"></i>
        <strong>Please correct the following errors:</strong>
        <ul id="errorList"></ul>
      </div>
    </div>

    <form id="complaintForm" method="post" enctype="multipart/form-data" novalidate>
      {% csrf_token %}

      <!-- Step 1: Complainant Information -->
      <div class="form-step active" id="form-step1">
        <h4 class="step-heading">
          <i class="fas fa-user-circle"></i>
          Complainant Information
        </h4>

        <div class="form-grid">
          <div class="form-group">
            <label for="{{ form.complainant_first_name.id_for_label }}" class="form-label">
              First Name <span class="required">*</span>
            </label>
            <div class="input-wrapper">
              <input type="text"
                     id="{{ form.complainant_first_name.id_for_label }}"
                     name="{{ form.complainant_first_name.name }}"
                     value="{{ form.complainant_first_name.value|default_if_none:'' }}"
                     class="form-control"
                     readonly>
              <i class="fas fa-user input-icon"></i>
            </div>
            <div class="invalid-feedback">{{ form.complainant_first_name.errors|first }}</div>
          </div>

          <div class="form-group">
            <label for="{{ form.complainant_last_name.id_for_label }}" class="form-label">
              Last Name <span class="required">*</span>
            </label>
            <div class="input-wrapper">
              <input type="text"
                     id="{{ form.complainant_last_name.id_for_label }}"
                     name="{{ form.complainant_last_name.name }}"
                     value="{{ form.complainant_last_name.value|default_if_none:'' }}"
                     class="form-control"
                     readonly>
              <i class="fas fa-user input-icon"></i>
            </div>
            <div class="invalid-feedback">{{ form.complainant_last_name.errors|first }}</div>
          </div>

          <div class="form-group">
            <label for="{{ form.complainant_email.id_for_label }}" class="form-label">
              Email <span class="required">*</span>
            </label>
            <div class="input-wrapper">
              <input type="email"
                     id="{{ form.complainant_email.id_for_label }}"
                     name="{{ form.complainant_email.name }}"
                     value="{{ form.complainant_email.value|default_if_none:'' }}"
                     class="form-control"
                     readonly>
              <i class="fas fa-envelope input-icon"></i>
            </div>
            <div class="invalid-feedback">{{ form.complainant_email.errors|first }}</div>
          </div>

          <div class="form-group">
            <label for="{{ form.complainant_phone.id_for_label }}" class="form-label">
              Phone <span class="required">*</span>
            </label>
            <div class="input-wrapper">
              <input type="text"
                     id="{{ form.complainant_phone.id_for_label }}"
                     name="{{ form.complainant_phone.name }}"
                     value="{{ form.complainant_phone.value|default_if_none:'' }}"
                     class="form-control"
                     readonly>
              <i class="fas fa-phone input-icon"></i>
            </div>
            <div class="invalid-feedback">{{ form.complainant_phone.errors|first }}</div>
          </div>

          <div class="form-group full-width">
            <label for="{{ form.complainant_address.id_for_label }}" class="form-label">
              Address <span class="required">*</span>
            </label>
            <div class="input-wrapper">
              {{ form.complainant_address }}
              <i class="fas fa-map-marker-alt input-icon"></i>
            </div>
            <div class="invalid-feedback">{{ form.complainant_address.errors|first }}</div>
          </div>

          <div class="form-group full-width">
            <label for="{{ form.complainant_instructor_name.id_for_label }}" class="form-label">
              Instructor Name (if student)
            </label>
            <div class="input-wrapper">
              {{ form.complainant_instructor_name }}
              <i class="fas fa-chalkboard-teacher input-icon"></i>
            </div>
            <div class="invalid-feedback">{{ form.complainant_instructor_name.errors|first }}</div>
          </div>
        </div>

        <div class="btn-nav">
          <button type="button" class="btn btn-secondary" disabled>
            <i class="fas fa-arrow-left"></i> Previous
          </button>
          <button type="button" class="btn btn-primary next-step">
            Next <i class="fas fa-arrow-right"></i>
          </button>
        </div>
      </div>

      <!-- Step 2: Respondent Information -->
      <div class="form-step" id="form-step2">
        <h4 class="step-heading">
          <i class="fas fa-user-tag"></i>
          Respondent Information
        </h4>

        <div class="form-grid">
          <div class="form-group full-width">
            <label for="{{ form.respondent_type.id_for_label }}" class="form-label">
              Respondent Type <span class="required">*</span>
            </label>
            <div class="input-wrapper">
              {{ form.respondent_type }}
              <i class="fas fa-users input-icon"></i>
            </div>
            <div class="invalid-feedback">{{ form.respondent_type.errors|first }}</div>
          </div>

          <div class="form-group">
            <label for="{{ form.respondent_first_name.id_for_label }}" class="form-label">
              First Name <span class="required">*</span>
            </label>
            <div class="input-wrapper">
              {{ form.respondent_first_name }}
              <i class="fas fa-user input-icon"></i>
            </div>
            <div class="invalid-feedback">{{ form.respondent_first_name.errors|first }}</div>
          </div>

          <div class="form-group">
            <label for="{{ form.respondent_last_name.id_for_label }}" class="form-label">
              Last Name <span class="required">*</span>
            </label>
            <div class="input-wrapper">
              {{ form.respondent_last_name }}
              <i class="fas fa-user input-icon"></i>
            </div>
            <div class="invalid-feedback">{{ form.respondent_last_name.errors|first }}</div>
          </div>

          <!-- Student Fields -->
          <div class="student-fields" style="display: none;">
              <div class="form-group">
                <label for="{{ form.respondent_course.id_for_label }}" class="form-label">
                    Course <span class="required">*</span>
                </label>
                <div class="input-wrapper">
                    {{ form.respondent_course }}
                    <i class="fas fa-graduation-cap input-icon"></i>
                </div>
                <div class="invalid-feedback">{{ form.respondent_course.errors|first }}</div>
              </div>

            <div class="form-group">
              <label for="{{ form.respondent_year.id_for_label }}" class="form-label">
                Year <span class="required">*</span>
              </label>
              <div class="input-wrapper">
                {{ form.respondent_year }}
                <i class="fas fa-calendar-alt input-icon"></i>
              </div>
              <div class="invalid-feedback">{{ form.respondent_year.errors|first }}</div>
            </div>

            <div class="form-group">
              <label for="{{ form.respondent_section.id_for_label }}" class="form-label">
                Section <span class="required">*</span>
              </label>
              <div class="input-wrapper">
                {{ form.respondent_section }}
                <i class="fas fa-users input-icon"></i>
              </div>
              <div class="invalid-feedback">{{ form.respondent_section.errors|first }}</div>
            </div>
          </div>

          <!-- Faculty/Staff Fields -->
          <div class="faculty-fields" style="display: none;">
            <div class="form-group full-width">
              <label for="{{ form.respondent_department.id_for_label }}" class="form-label">
                Department <span class="required">*</span>
              </label>
              <div class="input-wrapper">
                {{ form.respondent_department }}
                <i class="fas fa-building input-icon"></i>
              </div>
              <div class="invalid-feedback">{{ form.respondent_department.errors|first }}</div>
            </div>
          </div>
        </div>

        <div class="btn-nav">
          <button type="button" class="btn btn-outline-primary prev-step">
            <i class="fas fa-arrow-left"></i> Previous
          </button>
          <button type="button" class="btn btn-primary next-step">
            Next <i class="fas fa-arrow-right"></i>
          </button>
        </div>
      </div>

      <!-- Step 3: Complaint Details -->
      <div class="form-step" id="form-step3">
        <h4 class="step-heading">
          <i class="fas fa-file-alt"></i>
          Complaint Details
        </h4>

        <div class="form-grid">
          <div class="form-group full-width">
            <label for="{{ form.title.id_for_label }}" class="form-label">
              Title <span class="required">*</span>
            </label>
            <div class="input-wrapper">
              {{ form.title }}
              <i class="fas fa-heading input-icon"></i>
            </div>
            <div class="invalid-feedback">{{ form.title.errors|first }}</div>
          </div>

          <div class="form-group full-width">
            <label for="{{ form.statement.id_for_label }}" class="form-label">
              Statement <span class="required">*</span>
            </label>
            <div class="input-wrapper">
              {{ form.statement }}
              <i class="fas fa-align-left input-icon"></i>
            </div>
            <div class="invalid-feedback">{{ form.statement.errors|first }}</div>
          </div>

          <div class="form-group">
            <label for="{{ form.incident_date.id_for_label }}" class="form-label">
              Incident Date <span class="required">*</span>
            </label>
            <div class="input-wrapper">
              {{ form.incident_date }}
              <i class="fas fa-calendar-day input-icon"></i>
            </div>
            <div class="invalid-feedback">{{ form.incident_date.errors|first }}</div>
          </div>

          <div class="form-group">
            <label for="{{ form.incident_time.id_for_label }}" class="form-label">
              Incident Time (optional)
            </label>
            <div class="input-wrapper">
              {{ form.incident_time }}
              <i class="fas fa-clock input-icon"></i>
            </div>
            <div class="invalid-feedback">{{ form.incident_time.errors|first }}</div>
          </div>

          <div class="form-group full-width">
            <label for="{{ form.incident_location.id_for_label }}" class="form-label">
              Incident Location <span class="required">*</span>
            </label>
            <div class="input-wrapper">
              {{ form.incident_location }}
              <i class="fas fa-map-marked-alt input-icon"></i>
            </div>
            <div class="invalid-feedback">{{ form.incident_location.errors|first }}</div>
          </div>

          <div class="form-group full-width">
            <label for="{{ form.witnesses.id_for_label }}" class="form-label">
              Witnesses (if any)
            </label>
            <div class="input-wrapper">
              {{ form.witnesses }}
              <i class="fas fa-eye input-icon"></i>
            </div>
            <div class="invalid-feedback">{{ form.witnesses.errors|first }}</div>
          </div>

          {% if object and request.user.is_superuser %}
          <div class="form-group full-width">
            <label for="{{ form.notes.id_for_label }}" class="form-label">
              Admin Notes
            </label>
            <div class="input-wrapper">
              {{ form.notes }}
              <i class="fas fa-sticky-note input-icon"></i>
            </div>
            <div class="invalid-feedback">{{ form.notes.errors|first }}</div>
          </div>
          {% endif %}
        </div>

        <div class="btn-nav">
          <button type="button" class="btn btn-outline-primary prev-step">
            <i class="fas fa-arrow-left"></i> Previous
          </button>
          <button type="button" class="btn btn-primary next-step">
            Next <i class="fas fa-arrow-right"></i>
          </button>
        </div>
      </div>

      <!-- Step 4: Supporting Documents -->
      <div class="form-step" id="form-step4">
        <h4 class="step-heading">
          <i class="fas fa-paperclip"></i>
          Supporting Documents
        </h4>
        <p class="step-description">Upload any supporting documents, images, or videos related to your complaint.</p>

        <div class="document-grid">
          <!-- Documents Card -->
          <div class="document-card">
            <div class="document-icon">
              <i class="fas fa-file-alt"></i>
            </div>
            <h5 class="document-title">Documents</h5>
            <div class="file-upload-wrapper">
              <input type="file" name="documents" id="documents" class="form-control" multiple>
              <label for="documents" class="file-upload-label">
                <i class="fas fa-cloud-upload-alt"></i>
                <span>Choose Files</span>
              </label>
            </div>
            <div class="input-wrapper">
              <input type="text" name="document_description" placeholder="Description (optional)" class="form-control">
              <i class="fas fa-comment-alt input-icon"></i>
            </div>
            <div class="file-preview-container" id="document-preview">
              <div class="file-preview-header">
                <span>Selected Documents (0)</span>
              </div>
              <div class="file-preview-list"></div>
            </div>
          </div>

          <!-- Images Card -->
          <div class="document-card">
            <div class="document-icon">
              <i class="fas fa-image"></i>
            </div>
            <h5 class="document-title">Images</h5>
            <div class="file-upload-wrapper">
              <input type="file" name="images" id="images" class="form-control" accept="image/*" multiple>
              <label for="images" class="file-upload-label">
                <i class="fas fa-cloud-upload-alt"></i>
                <span>Choose Files</span>
              </label>
            </div>
            <div class="input-wrapper">
              <input type="text" name="image_caption" placeholder="Caption (optional)" class="form-control">
              <i class="fas fa-comment-alt input-icon"></i>
            </div>
            <div class="file-preview-container" id="image-preview">
              <div class="file-preview-header">
                <span>Selected Images (0)</span>
              </div>
              <div class="file-preview-list"></div>
            </div>
          </div>

        </div>

        <div class="btn-nav">
          <button type="button" class="btn btn-outline-primary prev-step">
            <i class="fas fa-arrow-left"></i> Previous
          </button>
          <button type="submit" class="btn btn-primary">
            {% if object %}
              <i class="fas fa-save"></i> Update Complaint
            {% else %}
              <i class="fas fa-paper-plane"></i> Submit Complaint
            {% endif %}
          </button>
        </div>
      </div>

      <!-- Success Message -->
      <div class="form-step" id="form-step5">
        <div class="success-message">
          <div class="success-icon">
            <i class="fas fa-check-circle"></i>
          </div>
          <h3 class="success-title">Complaint Submitted Successfully!</h3>
          <p class="success-description">Your complaint has been received and will be processed shortly.</p>

          <div class="success-card">
            <div class="success-badge">
              <i class="fas fa-hashtag"></i>
              <span>Reference Number:</span>
            </div>
            <div class="complaint-id" id="complaint-id">CP-2023-XXXXX</div>
            <p class="complaint-note">Please keep this number for all future correspondence regarding your complaint.</p>
          </div>

          <div class="next-steps">
            <h4 class="steps-title">
              <i class="fas fa-list-ol"></i>
              Important Next Steps
            </h4>

            <div class="step-item">
              <div class="step-number">1</div>
              <div class="step-content">
                <h5>Initial Visit (Within 1 Week)</h5>
                <ul>
                  <li>Visit the Office within <span class="highlight">7 calendar days</span> from today</li>
                  <li>Be prepared to provide additional details about your complaint</li>
                  <li>Be prepared for possible mediation or resolution discussions</li>
                  <li>Bring all supporting documents uploaded with this complaint</li>
                  <li>Return with any witnesses for authentication and vocal evaluation</li>
                </ul>
              </div>
            </div>

            <div class="warning-note">
              <i class="fas fa-exclamation-triangle"></i>
              <strong>Note:</strong> Failure to complete these steps may result in the dismissal of your complaint.
            </div>
          </div>

          <div class="contact-info">
            <h4 class="contact-title">
              <i class="fas fa-info-circle"></i>
              Contact Information
            </h4>

            <div class="contact-grid">
              <div class="contact-item">
                <i class="fas fa-map-marker-alt"></i>
                <div>
                  <h5>Office Location</h5>
                  <p>Office of Student Affairs, Administration Building, Ground Floor</p>
                </div>
              </div>

              <div class="contact-item">
                <i class="fas fa-clock"></i>
                <div>
                  <h5>Office Hours</h5>
                  <p>Monday-Friday: 8:00 AM - 5:00 PM</p>
                  <p>Saturday: 9:00 AM - 12:00 PM</p>
                </div>
              </div>

              <div class="contact-item">
                <i class="fas fa-phone"></i>
                <div>
                  <h5>Contact</h5>
                  <p>Phone: (123) 456-7890</p>
                  <p>Email: osa@university.edu</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Action Buttons Section -->
          <div class="action-buttons">
            {% if user.is_authenticated %}
              <a href="{% url 'dashboard' %}" class="btn btn-primary">
                <i class="fas fa-tachometer-alt"></i> Back to Dashboard
              </a>
            {% else %}
              <a href="{% url 'home' %}" class="btn btn-primary">
                <i class="fas fa-home"></i> Back to Home
              </a>
            {% endif %}
            <button class="btn btn-secondary" id="downloadComplaint">
              <i class="fas fa-download"></i> Download PDF
            </button>
          </div>
        </div>
      </div>
    </form>
  </div>
</div>

<script>
  const IS_EDIT_MODE = {% if object %}true{% else %}false{% endif %};
</script>
<script src="{% static 'js/core/complaint.js' %}"></script>

    {% include 'core/footer.html' %}
</body>
</html>