<div id="ojtApplicationExportModal" class="modal">
  <div class="modal-overlay" onclick="closeOJTApplicationExportModal()"></div>
  <div class="modal-container wide-modal">
    <div class="modal-header">
      <div class="header-content">
        <h2>Export OJT Applications Data</h2>
        <p class="header-description">Choose which applications to export</p>
      </div>
      <button class="modal-close" onclick="closeOJTApplicationExportModal()">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="var(--white)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>

    <form id="ojtApplicationExportForm" class="approval-form" method="post" action="{% url 'export-ojt-applications' %}">
      {% csrf_token %}
      <div class="form-body">
        <div class="form-intro">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="var(--primary)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
            <polyline points="7 10 12 15 17 10"></polyline>
            <line x1="12" y1="15" x2="12" y2="3"></line>
          </svg>
          <p>Export OJT application data with filtering options in Excel format.</p>
        </div>

        <div id="ojtApplicationExportFormResponse" class="form-response"></div>

        <div class="form-main-layout">
          <div class="form-column">
            <div class="form-section">
              <h3 class="section-title">Export Scope</h3>

              <div class="form-group">
                <label for="exportScope">Applications to Export</label>
                <select id="exportScope" name="export_scope" class="form-input" onchange="handleOJTExportScopeChange()">
                  <option value="all">All Applications</option>
                  <option value="by_company">By Company</option>
                  <option value="by_status">By Status</option>
                  <option value="by_company_status">By Company & Status</option>
                  <option value="current_filters">Current Table Filters</option>
                </select>
              </div>

              <!-- Company Filter Section -->
              <div id="companyFilterSection" class="form-group" style="display: none;">
                <label for="exportCompany">Select Company</label>
                <select id="exportCompany" name="export_company" class="form-input" onchange="updateOJTExportPreview()">
                  <option value="">All Companies</option>
                  {% for company in ojt_companies %}
                  <option value="{{ company.id }}">{{ company.name }}</option>
                  {% endfor %}
                </select>
              </div>

              <!-- Status Filter Section -->
              <div id="statusFilterSection" class="form-group" style="display: none;">
                <label for="exportStatus">Select Status</label>
                <select id="exportStatus" name="export_status" class="form-input" onchange="updateOJTExportPreview()">
                  <option value="">All Statuses</option>
                  <option value="draft">Draft</option>
                  <option value="submitted">Submitted</option>
                  <option value="under_review">Under Review</option>
                  <option value="approved">Approved</option>
                  <option value="rejected">Rejected</option>
                  <option value="cancelled">Cancelled</option>
                </select>
              </div>

              <!-- Date Range Section -->
              <div class="form-group">
                <label for="dateRange">Date Range (Optional)</label>
                <select id="dateRange" name="date_range" class="form-input" onchange="handleDateRangeChange()">
                  <option value="all">All Dates</option>
                  <option value="custom">Custom Range</option>
                  <option value="last_7_days">Last 7 Days</option>
                  <option value="last_30_days">Last 30 Days</option>
                  <option value="this_month">This Month</option>
                  <option value="last_month">Last Month</option>
                </select>
              </div>

              <div id="customDateRangeSection" class="form-group" style="display: none;">
                <div class="form-row">
                  <div class="form-col">
                    <label for="startDate">Start Date</label>
                    <input type="date" id="startDate" name="start_date" class="form-input" onchange="updateOJTExportPreview()">
                  </div>
                  <div class="form-col">
                    <label for="endDate">End Date</label>
                    <input type="date" id="endDate" name="end_date" class="form-input" onchange="updateOJTExportPreview()">
                  </div>
                </div>
              </div>

              <div class="form-group">
                <label for="exportApplicationTitle">Report Title</label>
                <input type="text" id="exportApplicationTitle" name="export_title" class="form-input"
                       placeholder="OJT Applications Report" value="OJT Applications Report" oninput="updateOJTExportPreview()">
              </div>

              <div class="form-group">
                <label class="checkbox-label">
                  <input type="checkbox" id="includeRequirements" name="include_requirements" checked onchange="updateOJTExportPreview()">
                  <span>Include requirements status</span>
                </label>
                <small class="form-hint">Show requirements submitted/verified status</small>
              </div>

              <div class="form-group">
                <label class="checkbox-label">
                  <input type="checkbox" id="includeReviewNotes" name="include_review_notes" checked onchange="updateOJTExportPreview()">
                  <span>Include review notes & comments</span>
                </label>
                <small class="form-hint">Include review notes and rejection reasons</small>
              </div>
            </div>
          </div>

          <div class="form-column">
            <div class="form-section">
              <h3 class="section-title">Export Preview</h3>
              <div class="export-preview">
                <div class="preview-item">
                  <strong>Export Scope:</strong>
                  <span id="previewExportScope">All Applications</span>
                </div>
                <div class="preview-item">
                  <strong>Selected Company:</strong>
                  <span id="previewSelectedCompany">-</span>
                </div>
                <div class="preview-item">
                  <strong>Selected Status:</strong>
                  <span id="previewSelectedStatus">-</span>
                </div>
                <div class="preview-item">
                  <strong>Date Range:</strong>
                  <span id="previewDateRange">All Dates</span>
                </div>
                <div class="preview-item">
                  <strong>Includes Requirements:</strong>
                  <span id="previewIncludesRequirements">Yes</span>
                </div>
                <div class="preview-item">
                  <strong>Includes Review Notes:</strong>
                  <span id="previewIncludesReviewNotes">Yes</span>
                </div>
                <div class="preview-item">
                  <strong>Estimated Records:</strong>
                  <span id="previewEstimatedRecords">Calculating...</span>
                </div>
              </div>
            </div>

            <div class="form-section">
              <h3 class="section-title">Export Summary</h3>
              <div class="export-summary">
                <div class="summary-item">
                  <i class='bx bx-info-circle'></i>
                  <div>
                    <strong>Format:</strong> Professional Excel report
                  </div>
                </div>
                <div class="summary-item">
                  <i class='bx bx-time'></i>
                  <div>
                    <strong>Generated:</strong> <span id="currentOJTTime"></span>
                  </div>
                </div>
                <div class="summary-item">
                  <i class='bx bx-data'></i>
                  <div>
                    <strong>Includes:</strong> Application details, student info, company info
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-cancel" onclick="closeOJTApplicationExportModal()">Cancel</button>
        <button type="submit" class="btn btn-primary" id="ojtExportSubmitBtn">
          <span class="btn-text">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
              <polyline points="7 10 12 15 17 10"></polyline>
              <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
            Export to Excel
          </span>
          <span class="btn-loader">
            <svg viewBox="0 0 50 50">
              <circle cx="25" cy="25" r="20" fill="none" stroke-width="5"></circle>
            </svg>
          </span>
        </button>
      </div>
    </form>
  </div>
</div>